# The updates channel delivers all the page updates created (primarily) through <tt>Turbo::Broadcastable</tt>.
# A subscription to this channel is made for each individual stream that one wishes to listen for updates to.
# The subscription relies on being passed a <tt>signed_stream_name</tt> parameter generated by turning a set of streamables
# into signed stream name using <tt>Turbo::Stream::StreamName#signed_stream_name</tt>. This is automatically done
# using the view helper <tt>Turbo::StreamHelper#subscribe_to_turbo_stream_from_signed(*streamables)</tt>.
# If the signed stream name cannot be verified, the subscription is rejected.
class Turbo::StreamChannel < ActionCable::Channel::Base
  extend Turbo::Stream::Broadcasts, Turbo::Stream::StreamName

  def subscribed
    if verified_stream_name = self.class.verified_stream_name(params[:signed_stream_name])
      stream_from verified_stream_name
    else
      reject
    end
  end
end
